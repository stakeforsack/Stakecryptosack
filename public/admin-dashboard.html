<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Admin Dashboard - GodStake</title>
<link rel="stylesheet" href="/css/premium.css">
<style>
    body { background:#0b0b0b; color:white; font-family:Inter; }
    pre { background:#111; padding:12px; border-radius:6px; white-space:pre-wrap; border:1px solid #333; }
    input { padding:8px; width:250px; border-radius:6px; border:1px solid #555; background:#111; color:white; }
    button { padding:10px 16px; background:#a855f7; border:none; color:white; border-radius:6px; cursor:pointer; }
    button:hover { background:#9333ea; }
</style>
</head>

<body>

<div class="container">

  <div class="header">
    <div class="logo">GodStake Admin</div>
    <div><input id="adminKey" placeholder="Admin Key" /></div>
  </div>

  <div style="height:20px"></div>

  <div class="admin-panel">

    <div>

      <!-- PENDING DEPOSITS -->
      <div class="card neon-glow">
        <h3>Pending Deposits</h3>
        <pre id="deposits"></pre>
      </div>

      <div style="height:18px"></div>

      <!-- PENDING WITHDRAWALS -->
      <div class="card neon-glow">
        <h3>Pending Withdrawals</h3>
        <pre id="withdraws"></pre>
      </div>

    </div>

    <!-- ACTION PANEL -->
    <div class="card">
      <h3>Actions</h3>

      <button id="refresh" style="width:100%">Refresh Lists</button>

      <div style="height:12px"></div>

      <div>
        <strong>Approve Deposit</strong><br/>
        <input id="approveTx" placeholder="Deposit txId">
        <button id="approveDep" style="width:100%; margin-top:8px">Approve Deposit</button>
      </div>

      <div style="height:12px"></div>

      <div>
        <strong>Approve Withdraw</strong><br/>
        <input id="approveWTx" placeholder="Withdraw txId">
        <button id="approveW" style="width:100%; margin-top:8px">Approve Withdraw</button>
      </div>
    </div>

  </div>

  <div style="height:20px"></div>

  <!-- ALL TRANSACTIONS -->
  <div class="card">
    <h3>All Transactions</h3>
    <pre id="allTx" style="max-height:250px; overflow:auto"></pre>
  </div>

</div>

<script>

// ---- API WRAPPER ----
async function adminAPI(endpoint, method="GET", body=null) {
  const key = document.getElementById("adminKey").value.trim();
  if (!key) return alert("Enter Admin Key");

  const opts = {
    method,
    headers: {
      "Content-Type": "application/json",
      "x-admin-key": key
    }
  };

  if (body) opts.body = JSON.stringify(body);

  const res = await fetch(endpoint, opts);
  const text = await res.text();
  try { return JSON.parse(text); } catch { return text; }
}

// ---- REFRESH LISTS ----
async function refreshLists() {
  const deps = await adminAPI("/api/admin/pending-deposits");
  const wds = await adminAPI("/api/admin/pending-withdraws");
  const txs = await adminAPI("/api/admin/all-transactions");

  document.getElementById("deposits").innerText = JSON.stringify(deps, null, 2);
  document.getElementById("withdraws").innerText = JSON.stringify(wds, null, 2);
  document.getElementById("allTx").innerText = JSON.stringify(txs, null, 2);
}

document.getElementById("refresh").onclick = refreshLists;

// ---- APPROVE DEPOSIT ----
document.getElementById("approveDep").onclick = async () => {
  const txId = document.getElementById("approveTx").value.trim();
  if (!txId) return alert("Enter a deposit txId");

  const result = await adminAPI("/api/admin/approve-deposit", "POST", { txId });
  alert("Deposit approved");

  refreshLists();
};

// ---- APPROVE WITHDRAW ----
document.getElementById("approveW").onclick = async () => {
  const txId = document.getElementById("approveWTx").value.trim();
  if (!txId) return alert("Enter withdraw txId");

  const tx_hash = prompt("Enter blockchain tx hash:");
  if (!tx_hash) return alert("Approval cancelled.");

  const result = await adminAPI("/api/admin/approve-withdraw", "POST", { txId, tx_hash });
  alert("Withdraw approved");

  refreshLists();
};

// Auto-load on open
refreshLists();

</script>

</body>
</html>

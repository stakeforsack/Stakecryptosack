<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trade • Live Charts</title>

  <style>
    :root {
      --bg1: #050507;
      --bg2: #0b0b12;
      --card: rgba(255,255,255,0.03);
      --border: rgba(255,255,255,0.06);
      --accent: #a855f7;
      --accent2: #5eead4;
      --success: #74ffb0;
      --danger: #ff5f77;
      --muted: #9aa3b2;
    }

    body {
      margin: 0;
      padding: 16px;
      background: linear-gradient(180deg, var(--bg1), var(--bg2));
      color: #fff;
      font-family: "Inter", sans-serif;
      padding-bottom: 100px;
    }

    h1 {
      font-size: 1.8rem;
      font-weight: 800;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 4px;
    }

    .sub {
      color: var(--muted);
      margin-bottom: 14px;
      font-size: 0.9rem;
    }

    .coins {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .coin {
      background: var(--card);
      border: 1px solid var(--border);
      padding: 14px;
      border-radius: 14px;
      cursor: pointer;
      transition: .25s;
    }

    .coin.active {
      border-color: var(--accent);
      box-shadow: 0 0 18px rgba(168,85,247,0.25);
      transform: translateY(-3px);
    }

    .coin img {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      margin-bottom: 6px;
    }

    .coin .name { font-weight: 700; }
    .coin .pair { font-size: 0.8rem; color: var(--muted); }
    .coin .price { margin-top: 6px; font-size: 1.1rem; font-weight: 700; }
    .change.pos { color: var(--success); }
    .change.neg { color: var(--danger); }

    /* Chart card */
    #chartBox {
      margin-top: 18px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px;
      display: none;
    }

    #chartTitle {
      font-size: 1.1rem;
      font-weight: 700;
    }

    #priceChart {
      width: 100%;
      height: 260px;
      margin-top: 10px;
    }

    .periods {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .periods button {
      padding: 6px 12px;
      border-radius: 10px;
      border: none;
      background: var(--border);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: .2s;
    }

    .periods button.active {
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      color: #041;
    }

    /* Bottom nav */
    .bottom-nav {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.04);
      backdrop-filter: blur(18px);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 22px;
      padding: 10px 20px;
      display: flex;
      gap: 28px;
      z-index: 999;
    }

    .nav-item {
      text-align: center;
      font-size: 0.85rem;
      color: var(--muted);
      text-decoration: none;
    }

    .nav-item.active {
      color: var(--accent);
      font-weight: 700;
    }

    .nav-item img {
      width: 22px;
      height: 22px;
      margin-bottom: 3px;
    }
  </style>
</head>

<body>

  <h1>Markets & Live Chart</h1>
  <div class="sub">Tap a coin to view its chart & price action.</div>

  <div class="coins">
    <div class="coin" data-coin="bitcoin" data-name="Bitcoin (BTC)">
      <img src="/img/btc.png">
      <div class="name">Bitcoin</div>
      <div class="pair">BTC / USDT</div>
      <div class="price" data-price-id="bitcoin">—</div>
      <div class="change" data-change-id="bitcoin">—</div>
    </div>

    <div class="coin" data-coin="ethereum" data-name="Ethereum (ETH)">
      <img src="/img/eth.png">
      <div class="name">Ethereum</div>
      <div class="pair">ETH / USDT</div>
      <div class="price" data-price-id="ethereum">—</div>
      <div class="change" data-change-id="ethereum">—</div>
    </div>

    <div class="coin" data-coin="tether" data-name="Tether (USDT)">
      <img src="/img/usdt.png">
      <div class="name">Tether</div>
      <div class="pair">USDT</div>
      <div class="price" data-price-id="tether">—</div>
      <div class="change" data-change-id="tether">—</div>
    </div>

    <div class="coin" data-coin="cardano" data-name="Cardano (ADA)">
      <img src="/img/ada.png">
      <div class="name">Cardano</div>
      <div class="pair">ADA / USDT</div>
      <div class="price" data-price-id="cardano">—</div>
      <div class="change" data-change-id="cardano">—</div>
    </div>

    <div class="coin" data-coin="binancecoin" data-name="Binance Coin (BNB)">
      <img src="/img/bnb.png">
      <div class="name">Binance</div>
      <div class="pair">BNB / USDT</div>
      <div class="price" data-price-id="binancecoin">—</div>
      <div class="change" data-change-id="binancecoin">—</div>
    </div>

    <div class="coin" data-coin="solana" data-name="Solana (SOL)">
      <img src="/img/sol.png">
      <div class="name">Solana</div>
      <div class="pair">SOL / USDT</div>
      <div class="price" data-price-id="solana">—</div>
      <div class="change" data-change-id="solana">—</div>
    </div>
  </div>

  <!-- chart box -->
  <div id="chartBox">
    <div id="chartTitle">—</div>
    <canvas id="priceChart"></canvas>

    <div class="periods">
      <button data-period="1">1D</button>
      <button data-period="7">7D</button>
      <button data-period="30" class="active">30D</button>
    </div>
  </div>

  <!-- Bottom nav -->
  <nav class="bottom-nav">
    <a class="nav-item" href="home.html"><img src="/img/house.png"><div>Home</div></a>
    <a class="nav-item active" href="trade.html"><img src="/img/trade.png"><div>Trade</div></a>
    <a class="nav-item" href="internal-transfer.html"><img src="/img/transfer.png"><div>Transfer</div></a>
    <a class="nav-item" href="account.html"><img src="/img/myaccount.png"><div>Account</div></a>
  </nav>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/js/market-prices.js"></script>

  <script>
    let chartInstance = null;

    async function loadChart(coin, days = 30) {
      document.getElementById("chartBox").style.display = "block";
      const ctx = document.getElementById("priceChart");

      const res = await fetch(`/api/chart/${coin}?days=${days}`);
      const data = await res.json();

      const prices = data.prices.map(p => p[1]);
      const labels = data.prices.map(p => new Date(p[0]).toLocaleTimeString());

      if (chartInstance) chartInstance.destroy();

      chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: coin,
            data: prices,
            borderColor: "#a855f7",
            backgroundColor: "rgba(168,85,247,0.15)",
            fill: true,
            tension: 0.3,
            borderWidth: 2,
          }]
        },
        options: {
          plugins: { legend: { display: false } },
          scales: {
            x: { ticks: { color: "#777" } },
            y: { ticks: { color: "#aaa" } },
          }
        }
      });
    }

    // coin selection
    document.querySelectorAll('.coin').forEach(c => {
      c.addEventListener("click", () => {
        document.querySelectorAll('.coin').forEach(x => x.classList.remove("active"));
        c.classList.add("active");

        document.getElementById("chartTitle").innerText = c.dataset.name;
        loadChart(c.dataset.coin, 30);
      });
    });

    // period buttons
    document.querySelectorAll('.periods button').forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll('.periods button').forEach(x => x.classList.remove("active"));
        btn.classList.add("active");

        const coin = document.querySelector('.coin.active')?.dataset.coin;
        if (coin) loadChart(coin, btn.dataset.period);
      });
    });

    // start live price updater
    MarketPrices.start(['bitcoin','ethereum','tether','cardano','binancecoin','solana'], 10000);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deposit | GodStake</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', sans-serif;
      background: #0b0b0b;
      color: #fff;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 600px;
      margin: 30px auto;
      background: #1a1a1a;
      padding: 30px;
      border-radius: 15px;
      border: 1px solid #333;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 25px;
      color: #a855f7;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #ccc;
      font-size: 0.95rem;
    }

    select, input {
      width: 100%;
      padding: 12px;
      background: #0b0b0b;
      border: 1px solid #333;
      border-radius: 8px;
      color: #fff;
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    select:focus, input:focus {
      outline: none;
      border-color: #a855f7;
    }

    button {
      width: 100%;
      padding: 12px;
      background: #a855f7;
      border: none;
      border-radius: 8px;
      color: #fff;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: 0.2s;
      margin-top: 10px;
    }

    button:hover:not(:disabled) {
      background: #9333ea;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .error {
      color: #ff6b6b;
      margin-top: 10px;
      padding: 10px;
      background: rgba(255,107,107,0.1);
      border-radius: 8px;
      display: none;
    }

    .success {
      color: #90ee90;
      margin-top: 10px;
      padding: 10px;
      background: rgba(144,238,144,0.1);
      border-radius: 8px;
      display: none;
    }

    /* Payment Details Section */
    .payment-section {
      display: none;
      margin-top: 30px;
      padding-top: 30px;
      border-top: 1px solid #333;
    }

    .payment-section.active {
      display: block;
    }

    .qr-container {
      text-align: center;
      margin: 20px 0;
    }

    .qr-code {
      width: 200px;
      height: 200px;
      background: #fff;
      padding: 10px;
      border-radius: 8px;
      display: inline-block;
    }

    .qr-code img {
      width: 100%;
      height: 100%;
    }

    .address-box {
      background: #0b0b0b;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      border: 1px solid #333;
      word-break: break-all;
    }

    .copy-btn {
      background: #5eead4;
      color: #000;
      padding: 8px 15px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
      transition: 0.2s;
    }

    .copy-btn:hover {
      background: #2dd4bf;
    }

    .info-text {
      color: #999;
      font-size: 0.9rem;
      margin: 15px 0;
      line-height: 1.6;
    }

    .back-link {
      text-align: center;
      margin-top: 20px;
    }

    .back-link a {
      color: #5eead4;
      text-decoration: none;
      font-weight: 600;
    }

    .back-link a:hover {
      text-decoration: underline;
    }

    .crypto-info {
      background: #0b0b0b;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 3px solid #a855f7;
    }

    .crypto-info p {
      font-size: 0.9rem;
      color: #ccc;
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>üí∞ Make a Deposit</h2>
    
    <form id="depositForm">
      <div class="form-group">
        <label for="coin">Select Cryptocurrency</label>
        <select id="coin" required>
          <option value="">-- Select Coin --</option>
          <option value="BTC">Bitcoin (BTC)</option>
          <option value="ETH">Ethereum (ETH)</option>
          <option value="USDT">Tether USDT (Ethereum)</option>
          <option value="BNB">Binance Coin (BNB)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="amount">Amount to Deposit</label>
        <input type="number" id="amount" placeholder="Enter amount" step="0.0001" min="0" required>
      </div>

      <div id="error" class="error"></div>
      <div id="success" class="success"></div>

      <button type="submit" id="submitBtn">Proceed to Payment</button>
    </form>

    <!-- Payment Instructions Section -->
    <div id="paymentSection" class="payment-section">
      <h3 style="color: #a855f7; margin-bottom: 20px;">üìù Payment Instructions</h3>
      
      <div class="crypto-info">
        <p><strong>Coin:</strong> <span id="selectedCoin"></span></p>
        <p><strong>Amount:</strong> <span id="depositAmount"></span></p>
        <p><strong>Status:</strong> <span style="color: #fbbf24;">Pending Payment</span></p>
      </div>

      <div class="info-text">
        ‚ö†Ô∏è Please send exactly <strong id="exactAmount"></strong> <span id="coinSymbol"></span> to the address below. Payment will be confirmed automatically once received on the blockchain.
      </div>

      <div class="qr-container">
        <p style="margin-bottom: 10px; font-weight: 600;">Scan with your wallet:</p>
        <div class="qr-code" id="qrCode">
          <img id="qrImage" src="" alt="QR Code" style="display: none;">
        </div>
      </div>

      <div>
        <p style="margin-bottom: 10px; font-weight: 600;">Or send to this address:</p>
        <div class="address-box" id="addressBox">
          <!-- Address will be populated here -->
        </div>
        <button type="button" class="copy-btn" onclick="copyAddress()">üìã Copy Address</button>
      </div>

      <div class="info-text">
        <strong>‚è±Ô∏è Waiting for payment...</strong><br>
        Your deposit request has been created. Once payment is confirmed on the blockchain, your account will be credited automatically.
      </div>

      <button type="button" style="background: #5eead4; color: #000; margin-top: 20px;" onclick="goBack()">‚Üê Back to Deposit</button>
    </div>
  </div>

  <div class="back-link">
    <a href="index.html">‚Üê Back to Dashboard</a>
  </div>

  <script>
    // Crypto payment data (Replace with your actual addresses and QR codes)
    const cryptoData = {
      BTC: {
        address: 'YOUR_BTC_ADDRESS_HERE',
        qrCode: 'https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=bitcoin:YOUR_BTC_ADDRESS_HERE'
      },
      ETH: {
        address: 'YOUR_ETH_ADDRESS_HERE',
        qrCode: 'https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=ethereum:YOUR_ETH_ADDRESS_HERE'
      },
      USDT: {
        address: 'YOUR_USDT_ADDRESS_HERE',
        qrCode: 'https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=ethereum:YOUR_USDT_ADDRESS_HERE'
      },
      BNB: {
        address: 'YOUR_BNB_ADDRESS_HERE',
        qrCode: 'https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=bnb:YOUR_BNB_ADDRESS_HERE'
      }
    };

    const form = document.getElementById('depositForm');
    const errorDiv = document.getElementById('error');
    const successDiv = document.getElementById('success');
    const submitBtn = document.getElementById('submitBtn');
    const paymentSection = document.getElementById('paymentSection');
    const coinSelect = document.getElementById('coin');
    const amountInput = document.getElementById('amount');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      errorDiv.style.display = 'none';
      successDiv.style.display = 'none';
      submitBtn.disabled = true;
      submitBtn.textContent = 'Processing...';

      const coin = coinSelect.value;
      const amount = amountInput.value;

      try {
        console.log('Submitting deposit:', { coin, amount });

        const response = await fetch('/api/deposit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ coin, amount: parseFloat(amount) })
        });

        console.log('Response status:', response.status);

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Deposit failed');
        }

        const data = await response.json();
        console.log('Deposit successful:', data);

        // Show payment instructions
        showPaymentDetails(coin, amount);
        successDiv.textContent = '‚úì Deposit request created! Please complete the payment below.';
        successDiv.style.display = 'block';

      } catch (err) {
        console.error('Deposit error:', err);
        const errorMsg = err instanceof Error ? err.message : 'Server error';
        errorDiv.textContent = '‚úó ' + errorMsg;
        errorDiv.style.display = 'block';
        submitBtn.disabled = false;
        submitBtn.textContent = 'Proceed to Payment';
      }
    });

    function showPaymentDetails(coin, amount) {
      const data = cryptoData[coin];
      if (!data) {
        console.error('Coin not found:', coin);
        return;
      }

      document.getElementById('selectedCoin').textContent = coin;
      document.getElementById('depositAmount').textContent = amount + ' ' + coin;
      document.getElementById('exactAmount').textContent = amount;
      document.getElementById('coinSymbol').textContent = coin;
      document.getElementById('addressBox').textContent = data.address;
      document.getElementById('qrImage').src = data.qrCode;
      document.getElementById('qrImage').style.display = 'block';

      paymentSection.classList.add('active');
      form.style.display = 'none';
    }

    function copyAddress() {
      const address = document.getElementById('addressBox').textContent;
      navigator.clipboard.writeText(address).then(() => {
        alert('Address copied to clipboard!');
      }).catch(err => {
        console.error('Failed to copy:', err);
      });
    }

    function goBack() {
      paymentSection.classList.remove('active');
      form.style.display = 'block';
      form.reset();
    }
  </script>
</body>
</html>
